(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{496:function(s,a,t){"use strict";t.r(a);var e=t(1),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("本文转载自："),t("a",{attrs:{href:"https://blog.csdn.net/mrathena/article/details/137073978",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker - Windows 11 专业版 23H2 下 Docker Desktop 的 下载 安装 配置 使用"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"docker-desktop"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-desktop"}},[s._v("#")]),s._v(" Docker Desktop")]),s._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"https://docs.docker.com/desktop/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Overview of Docker Desktop"),t("OutboundLink")],1),t("br"),s._v(" "),t("a",{attrs:{href:"https://docs.docker.com/desktop/troubleshoot/topics/#virtualization",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker Desktop 疑难解答 虚拟化"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("Docker Desktop for Windows, 可以在 Windows 上创建 Docker 环境, 支持在 CMD 中运行 docker 命令, 提供了简单的 GUI 界面, 方便管理镜像, 容器, 数据卷等内容")]),s._v(" "),t("h2",{attrs:{id:"准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[s._v("#")]),s._v(" 准备")]),s._v(" "),t("p",[s._v("在 Windows 安装 Docker Desktop 有两种选择")]),s._v(" "),t("ul",[t("li",[s._v("WSL 2 backend")]),s._v(" "),t("li",[s._v("Hyper-V backend and Windows containers")])]),s._v(" "),t("p",[s._v("Docker Desktop 推荐使用 "),t("code",[s._v("WSL 2 backend")]),s._v(", 因为 WSL 2 比 Hyper-V backend 有更好的性能. 后续内容都是基于 WSL 2 来说明")]),s._v(" "),t("h3",{attrs:{id:"系统要求-wsl-2-backend"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#系统要求-wsl-2-backend"}},[s._v("#")]),s._v(" 系统要求 (WSL 2 backend)")]),s._v(" "),t("ul",[t("li",[s._v("WSL 版本 1.1.3.0 或更高")]),s._v(" "),t("li",[s._v("Windows 11 64 位\n"),t("ul",[t("li",[s._v("21H2 或更高版本")])])]),s._v(" "),t("li",[s._v("Windows 10 64 位\n"),t("ul",[t("li",[s._v("建议使用 22H2（内部版本 19045）或更高版本")]),s._v(" "),t("li",[s._v("最低要求 21H2（内部版本 19044）或更高版本")])])]),s._v(" "),t("li",[s._v("在 Windows 上打开 WSL 2 功能")])]),s._v(" "),t("h3",{attrs:{id:"在-windows-上打开-wsl-2-功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在-windows-上打开-wsl-2-功能"}},[s._v("#")]),s._v(" 在 Windows 上打开 WSL 2 功能")]),s._v(" "),t("h4",{attrs:{id:"先决条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#先决条件"}},[s._v("#")]),s._v(" 先决条件")]),s._v(" "),t("ul",[t("li",[s._v("具有二级地址转换 （SLAT） 的 64 位处理器, 只要电脑不是老古董, 通常都满足")]),s._v(" "),t("li",[s._v("空余的 4GB 系统内存")]),s._v(" "),t("li",[s._v("在 BIOS 中启用硬件虚拟化, 可通过如下方式确认是否已启用虚拟化")])]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"1","data-src":"/vuepress-blog/img/post/2024-06-06-02/1.webp",loading:"lazy"}})]),s._v(" "),t("h4",{attrs:{id:"开启-wsl-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启-wsl-2"}},[s._v("#")]),s._v(" 开启 WSL 2")]),s._v(" "),t("p",[s._v("开启 WSL 2 有两种方式")]),s._v(" "),t("ul",[t("li",[s._v("以管理员方式运行 "),t("code",[s._v("wsl --install")]),s._v(" 并重启系统, 此命令将启用运行 WSL 所需的功能, 并默认安装 Linux 的 Ubuntu 发行版. Docker Desktop 其实并不依赖任何 Linux 发行版, 所以通过该命令安装的 Ubuntu 其实是不必要的")]),s._v(" "),t("li",[s._v("手动分步开启 WSL 2\n"),t("ul",[t("li",[s._v("启用 "),t("code",[s._v("适用于 Linux 的 Windows 子系统")]),s._v(" 和 "),t("code",[s._v("虚拟机平台")]),s._v(" 两个可选功能, 如果是专业版或企业版系统, 还可以启用 "),t("code",[s._v("Hyper-V")]),s._v(" 可选功能, 然后必须重启系统")]),s._v(" "),t("li",[s._v("执行 "),t("code",[s._v("wsl --update")]),s._v(" 更新 WSL 到当前最新版, 执行 "),t("code",[s._v("wsl --status")]),s._v(" 查看默认版本是否为 2, 如果不是则执行 "),t("code",[s._v("wsl --set-default-version 2")]),s._v(" 将默认版本设置为 2")])])])]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"2","data-src":"/vuepress-blog/img/post/2024-06-06-02/2.webp",loading:"lazy"}})]),s._v(" "),t("h2",{attrs:{id:"wsl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#wsl"}},[s._v("#")]),s._v(" WSL")]),s._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"https://learn.microsoft.com/zh-cn/windows/wsl/about",target:"_blank",rel:"noopener noreferrer"}},[s._v("什么是 WSL"),t("OutboundLink")],1),s._v(" "),t("a",{attrs:{href:"https://learn.microsoft.com/zh-cn/windows/wsl/compare-versions",target:"_blank",rel:"noopener noreferrer"}},[s._v("比较 WSL 版本"),t("OutboundLink")],1),s._v(" "),t("a",{attrs:{href:"https://docs.docker.com/desktop/wsl/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker Desktop WSL 2 backend on Windows"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("WSL 全称为 Windows Subsystem for Linux, 官网译为: 适用于 Linux 的 Windows 子系统 (WSL)")]),s._v(" "),t("p",[s._v("WSL 是 Windows 的一项功能，可用于在 Windows 计算机上运行 Linux 环境，而无需单独的虚拟机或双引导。 WSL 旨在为希望同时使用 Windows 和 Linux 的开发人员提供无缝高效的体验。")]),s._v(" "),t("p",[s._v("WSL 目前有两个模式, 分别是 WSL 1 和 WSL 2, WSL 2 使用最新最好的虚拟化技术在轻量级实用工具虚拟机 (VM) 内运行 Linux 内核. 简单来说, WSL 2 在大多情况下比 WSL 1 性能好兼容性好, 所以默认情况下都是使用 WSL 2 模式")]),s._v(" "),t("p",[s._v("Docker Desktop 不需要我们在 WSL 中安装任何 Linux 发行版。因为 Docker Desktop 自带两个专用的内部 Linux 发行版, 两者是 Docker Desktop 专用的, 不能用作其他用途")]),s._v(" "),t("ul",[t("li",[s._v("docker-desktop, 用于运行 Docker 引擎 （ dockerd ）")]),s._v(" "),t("li",[s._v("docker-desktop-data, 用于存储容器和映像")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 wsl 相关内容的版本")]),s._v("\nwsl --version\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 wsl 当前状态")]),s._v("\nwsl --status\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查 wsl 各 Linux 发行版的运行模式是 wsl 1 还是 wsl 2")]),s._v("\nwsl -l -v\n")])])]),t("h2",{attrs:{id:"下载安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载安装"}},[s._v("#")]),s._v(" 下载安装")]),s._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"https://www.docker.com/products/docker-desktop/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网下载"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("当前 Docker Desktop for Windows 版本是 4.28.0 (139021)")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"3","data-src":"/vuepress-blog/img/post/2024-06-06-02/3.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("Docker Desktop 推荐使用 WSL 2 代替 Hyper-V, 默认勾选不要取消, 等待安装完成即可")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"4","data-src":"/vuepress-blog/img/post/2024-06-06-02/4.webp",loading:"lazy"}})]),s._v(" "),t("h2",{attrs:{id:"启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"5","data-src":"/vuepress-blog/img/post/2024-06-06-02/5.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("接受 Docker 协议")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"6","data-src":"/vuepress-blog/img/post/2024-06-06-02/6.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("先选择不登录, 然后随便选两个角色, 就可以进入 Containers 面板")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"7","data-src":"/vuepress-blog/img/post/2024-06-06-02/7.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("如果启动一直卡 "),t("code",[s._v("Starting the Docker Engine")]),s._v(" 转圈, 可能是准备工作没有做好, 对照步骤检查一下")]),s._v(" "),t("h2",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"8","data-src":"/vuepress-blog/img/post/2024-06-06-02/8.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("其实也没什么好配置的, 镜像保存位置可以改一改, 这个内容我们也无法直接查看, 而且我只有一个 C 盘, 所以就不改了, 没有必要")]),s._v(" "),t("p",[s._v("有人会在 Docker Engine 配置项中配置镜像加速, 但是我体验下来感觉都不行, 都无法直接在 Docker Desktop 里搜索镜像, 结合我之前使用经验来看, 加速仓库的镜像不够新, 有些版本的镜像不存在, 而且现在拉取镜像好像不需要魔法速度就很快, 所以我觉得使用 Docker Desktop 搜索镜像的时候开一下魔法即可, 选择一个 Tag 版本, 然后通过命令行的方式去拉取镜像")]),s._v(" "),t("h2",{attrs:{id:"使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"https://docs.docker.com/desktop/wsl/best-practices/",target:"_blank",rel:"noopener noreferrer"}},[s._v("最佳实践"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("安装 Docker Desktop for Windows 后, 就可以像在 Linux 一样在 CMD 里执行 "),t("code",[s._v("docker")]),s._v(" 命令, GUI 算是一个补充功能, 能简化一些操作, 但是一些复杂操作或者特殊操作或者是 GUI 无法做到的操作, 都可以通过命令行得方式来执行. GUI 和 CMD 都是 Docker Engine 的一个操作入口, 其状态是完全一致的")]),s._v(" "),t("h3",{attrs:{id:"镜像-image"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像-image"}},[s._v("#")]),s._v(" 镜像 Image")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"9","data-src":"/vuepress-blog/img/post/2024-06-06-02/9.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("在不开魔法的情况下, 搜索不到镜像, 即使配置了镜像加速也没有效果, 所以我推荐这里开魔法")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"10","data-src":"/vuepress-blog/img/post/2024-06-06-02/10.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("打开魔法之后, 可以正常搜索到镜像, 比如第一个就是官方提供的 Redis 镜像")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"11","data-src":"/vuepress-blog/img/post/2024-06-06-02/11.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("这里有一个问题, 提供的 Tag 列表里没有 latest, 可能是因为该列表只显示最近的几个 Tag 而不是完整 Tag 列表, 可以点开 Redis 去看详细信息")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"12","data-src":"/vuepress-blog/img/post/2024-06-06-02/12.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("点开详情后, 我们看到是有 "),t("code",[s._v("latest")]),s._v(" Tag 的, 且 latest 版本就是 "),t("code",[s._v("7.2.4")]),s._v(" (一行的多个 Tag 都是同一个版本), 这时候我们可以关闭魔法, 通过 CMD 执行 "),t("code",[s._v("docker pull redis:7.2.4")]),s._v(" 来拉取最新的 Redis 镜像, 速度非常快")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"13","data-src":"/vuepress-blog/img/post/2024-06-06-02/13.webp",loading:"lazy"}})]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"14","data-src":"/vuepress-blog/img/post/2024-06-06-02/14.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("拉取成功后, 在 Docker Desktop 的 Images 面板中就会显示出来")]),s._v(" "),t("h3",{attrs:{id:"卷积-volumes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#卷积-volumes"}},[s._v("#")]),s._v(" 卷积 Volumes")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"15","data-src":"/vuepress-blog/img/post/2024-06-06-02/15.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("在 Volumes 面板可以创建 Volume, 等效于执行 "),t("code",[s._v("docker volume create")]),s._v(" 命令, 创建的 Volume 印射在 Windows 的 "),t("code",[s._v("\\\\wsl.localhost\\docker-desktop-data\\data\\docker\\volumes")]),s._v(" 路径, 有读写权限, 可以通过 Windows 资源管理器 直接操作")]),s._v(" "),t("p",[t("code",[s._v("docker run -v <host-path>:<container-path>")]),s._v(", Docker Desktop 建议 host-path 使用 Linux 容器中的路径而不是 Windows 路径, 这样可以充分利用文件系统性能. 由于我们不是直接使用 Linux 环境, 不确定 -v 参数指定 Linux 文件路径是否可行, 而 Volume 由 Docker 控制, 使用的是 Linux 容器中的路径, 而且也印射到了 Windows 资源管理器, 所以我认为使用 Volume 是比较好的方式")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"16","data-src":"/vuepress-blog/img/post/2024-06-06-02/16.webp",loading:"lazy"}})]),s._v(" "),t("h3",{attrs:{id:"容器-containers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#容器-containers"}},[s._v("#")]),s._v(" 容器 Containers")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"17","data-src":"/vuepress-blog/img/post/2024-06-06-02/17.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("在 Images 面板可以点击 Action 的 Run 按钮来创建并启动一个容器, 在这里, 我设置容器名称为 redis, 印射的主机端口为 6379, 印射的主机路径为一个名为 redis 的 volume, 而不是一个 Windows 路径, 印射的容器路径为 /data, 然后启动容器, 等效于执行如下命令, 使用的是 Redis 默认配置")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker run --name redis -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(":6379 -v redis:/data redis:7.2.4 redis-server\n")])])]),t("p",[s._v("通常我们启动 Redis 容器会指定一个自定义的配置文件 redis.conf, 该配置文件放到 redis 这个 volume 下, 用于控制 Redis 的行为, 执行命令如下, 这种后面带参数的命令, 通过 GUI 无法做到, 所以需要通过 CMD 来执行")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker run -d --name redis -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(":6379 -v redis:/data redis:7.2.4 redis-server /data/redis.conf\n")])])]),t("p",[s._v("通常我们启动 Redis 容器会指定一个自定义的配置文件 redis.conf, 该配置文件放到 redis 这个 volume 下, 用于控制 Redis 的行为, 执行命令如下, 这种后面带参数的命令, 通过 GUI 无法做到, 所以需要通过 CMD 来执行")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker run -d --name redis -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(":6379 -v redis:/data redis:7.2.4 redis-server /data/redis.conf\n")])])]),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"18","data-src":"/vuepress-blog/img/post/2024-06-06-02/18.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("在 Container 面板, 可以看到各容器的状态, 能够简单操作容器, 比如启动, 停止, 删除等")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"19","data-src":"/vuepress-blog/img/post/2024-06-06-02/19.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("点到容器内, 可以直接看到容器执行日志 Logs")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"20","data-src":"/vuepress-blog/img/post/2024-06-06-02/20.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("容器的信息 Inspect, 可以点击 Platform, Cmd, State 等标签直接跳转到信息的对应位置查看关键信息")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"21","data-src":"/vuepress-blog/img/post/2024-06-06-02/21.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("容器的文件 Files, 可以看到容器内的文件系统")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"22","data-src":"/vuepress-blog/img/post/2024-06-06-02/22.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("容器的状态 State, 可以看到容器的运行情况, 资源占用情况等信息")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"23","data-src":"/vuepress-blog/img/post/2024-06-06-02/23.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("可以在容器的 Exec 里执行命令, 相当于执行了 "),t("code",[s._v("docker exec -it redis /bin/bash")]),s._v(" 命令进入了容器, 进而在容器内部执行命令")]),s._v(" "),t("h2",{attrs:{id:"idea-docker-组件连接到-docker-desktop"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#idea-docker-组件连接到-docker-desktop"}},[s._v("#")]),s._v(" IDEA Docker 组件连接到 Docker Desktop")]),s._v(" "),t("p",[s._v("安装了 Docker Desktop 的话, 可以直接选择 Docker for Windows 连接方式, 里面有 default 和 desktop-linux 两种方式, 具体区别不是很清楚, 好像都能用")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"24","data-src":"/vuepress-blog/img/post/2024-06-06-02/24.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("配置好 Docker 以后, 在 Services 面板就可以看到 Docker 的 容器, 镜像, 网络, 卷 等内容了, 点进具体的组件里, 有提供一些简单的操作")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"25","data-src":"/vuepress-blog/img/post/2024-06-06-02/25.webp",loading:"lazy"}})]),s._v(" "),t("p",[s._v("在 Idea 中打开 Dockerfile 或者 docker-compose.yml 等配置文件时, Docker 组件提供一些便捷操作, 如下")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"26","data-src":"/vuepress-blog/img/post/2024-06-06-02/26.webp",loading:"lazy"}})]),s._v(" "),t("h2",{attrs:{id:"说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[s._v("#")]),s._v(" 说明")]),s._v(" "),t("p",[s._v("有一点需要说明, 新版本 Docker Engine 导出的 tar 格式有所变化, 可能无法导入到一些老的 Docker 仓库, 所以, 如果对 Docker Engine 版本有要求的可以选择合适版本的 Docker Desktop for Windows")])])}),[],!1,null,null,null);a.default=r.exports}}]);