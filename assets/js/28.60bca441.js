(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{418:function(a,t,n){"use strict";n.r(t);var s=n(1),e=Object(s.a)({},(function(){var a=this,t=a.$createElement,n=a._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("blockquote",[n("p",[a._v("本文转载自："),n("a",{attrs:{href:"https://juejin.cn/post/6986556857703727117?from=main_page",target:"_blank",rel:"noopener noreferrer"}},[a._v("小程序页面返回传值四种解决方案总结"),n("OutboundLink")],1)])]),a._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#使用场景"}},[a._v("使用场景")])]),n("li",[n("a",{attrs:{href:"#解决方案"}},[a._v("解决方案")]),n("ul",[n("li",[n("a",{attrs:{href:"#_1、使用globaldata实现"}},[a._v("1、使用globalData实现")])]),n("li",[n("a",{attrs:{href:"#_2、使用本地缓存storage实现"}},[a._v("2、使用本地缓存Storage实现")])]),n("li",[n("a",{attrs:{href:"#_3、使用小程序的page页面栈实现"}},[a._v("3、使用小程序的Page页面栈实现")])]),n("li",[n("a",{attrs:{href:"#_4、使用wx-navigateto-api的events实现"}},[a._v("4、使用wx.navigateTo API的events实现")])])])]),n("li",[n("a",{attrs:{href:"#总结"}},[a._v("总结")])])])]),n("p"),a._v(" "),n("h2",{attrs:{id:"使用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用场景"}},[a._v("#")]),a._v(" 使用场景")]),a._v(" "),n("p",[a._v("小程序从A页面跳转到B页面，在B页面选择一个值后返回到A页面，在A页面使用在B页面选中的值。例如：在购买订单页面跳转到地址列表，选择完地址以后回退到订单页面，订单页面的配送地址需要同步更新。")]),a._v(" "),n("h2",{attrs:{id:"解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[a._v("#")]),a._v(" 解决方案")]),a._v(" "),n("p",[a._v("常见的比容要容易解决的方案是使用小程序的全局存储globalData、本地缓存"),n("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fapi%2Fstorage%2Fwx.setStorageSync.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("storage"),n("OutboundLink")],1),a._v("、获取小程序的页面栈，调用上一个Page的setData方法、以及利用"),n("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fapi%2Froute%2Fwx.navigateTo.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("wx.navigateTo"),n("OutboundLink")],1),a._v("的events属性监听被打开页面发送到当前页面的数据。下面给大家简单对比下四种方法的优缺点：")]),a._v(" "),n("h3",{attrs:{id:"_1、使用globaldata实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、使用globaldata实现"}},[a._v("#")]),a._v(" 1、使用globalData实现")]),a._v(" "),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//page A")]),a._v("\nconst app = getApp() "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//获取App.js实例")]),a._v("\nonShow() "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//生命周期函数--监听页面显示")]),a._v("\n  if (app.globalData.backData) "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    this.setData("),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//将B页面更新完的值渲染到页面上")]),a._v("\n      backData"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" app.globalData.backData\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("()=>"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n     \tdelete app.globalData.backData "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//删除数据 避免onShow重复渲染")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(")\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//page B")]),a._v("\nconst app = getApp() "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//获取App.js实例")]),a._v("\nchangeBackData()"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n   app.globalData.backData = '我被修改了'\n   wx.navigateBack()\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),n("h3",{attrs:{id:"_2、使用本地缓存storage实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、使用本地缓存storage实现"}},[a._v("#")]),a._v(" 2、使用本地缓存Storage实现")]),a._v(" "),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//page A")]),a._v("\n  onShow"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" function () "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    let backData = wx.getStorageSync('backData')\n    if(backData)"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n       this.setData("),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n     \t\t backData\n    \t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("()=>"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n     \t\t wx.removeStorageSync('backData')\n    \t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(")\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//page B")]),a._v("\n changeBackData()"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    wx.setStorageSync('backData'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" '我被修改了')\n    wx.navigateBack()\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n")])])]),n("h3",{attrs:{id:"_3、使用小程序的page页面栈实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3、使用小程序的page页面栈实现"}},[a._v("#")]),a._v(" 3、使用小程序的Page页面栈实现")]),a._v(" "),n("p",[a._v("使小程序的页面栈，比其他两种方式会更方便一点而且渲染的会更快一些，不需要等回退到A页面上再把数据渲染出来，在B页面上的直接就会更新A页面上的值，回退到A页面的时候，值已经被更新了。globalData和Storage实现的原理都是在B页面上修改完值以后，回退到A页面，触发onShow生命周期函数，来更新页面渲染。")]),a._v(" "),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//page B")]),a._v("\nchangeBackData()"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    const pages = getCurrentPages();\n    const beforePage = pages"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("pages.length - "),n("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    beforePage.setData("),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//会直接更新A页面的数据，A页面不需要其他操作")]),a._v("\n      backData"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"我被修改了"')]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(")\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),n("h3",{attrs:{id:"_4、使用wx-navigateto-api的events实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4、使用wx-navigateto-api的events实现"}},[a._v("#")]),a._v(" 4、使用wx.navigateTo API的events实现")]),a._v(" "),n("p",[a._v("wx.navigateTo的events的实现原理是利用设计模式的发布订阅模式实现的，有兴趣的同学可以自己动手实现一个简单的，也可以实现相同的效果。")]),a._v(" "),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//page A")]),a._v("\n goPageB() "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    wx.navigateTo("),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      url"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" 'B'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      events"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        getBackData"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" res => "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//在events里面添加监听事件")]),a._v("\n          this.setData("),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            backData"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" res.backData\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(")\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(")\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//page B\t")]),a._v("\nchangeBackData()"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    const eventChannel = this.getOpenerEventChannel()\n       eventChannel.emit('getBackData'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("  \n     \t backData"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" '我被修改了'\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(");\n     wx.navigateBack()\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),n("p",[a._v("1和2两种方法在页面渲染效果上比后面两种稍微慢一点，3和4两种方法在B页面回退到A页面之前已经触发了更新，而1和2两种方法是等返回到A页面之后，在A页面才触发更新。并且1和2两种方式，要考虑到A页面更新完以后要删除globalData和Storage的数据，避免onShow方法里面重复触发setData更新页面，所以个人更推荐大家使用后面的3和4两种方式。")])])}),[],!1,null,null,null);t.default=e.exports}}]);